<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interlink QOTD</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.png" type="image/png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <style>
        /* Existing styles remain unchanged */
        .qotd-frame {
            background: var(--glass-background);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 800px;
        }
        .qotd-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .qotd-subject {
            color: #00FFFF;
            font-size: 1.2rem;
        }
        .qotd-date {
            color: #888;
            font-style: italic;
        }
        .qotd-specifics {
            color: #FFFFFF;
            margin-bottom: 1rem;
        }
        .qotd-question {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }
        .qotd-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .qotd-options textarea {
            width: 100%;
            height: 150px;
            padding: 0.5rem;
            font-size: 1.5rem;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            resize: none;
            color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .qotd-submit {
            margin-top: 2rem;
            text-align: center;
        }
        #qotdSubmit {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Orbitron', sans-serif;
        }
        #qotdSubmit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }
        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        .feedback.correct {
            background-color: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        .feedback.incorrect {
            background-color: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }
        .attempts {
            margin-top: 1rem;
            text-align: center;
            color: #888;
        }
        /* Multiple choice options styles */
        .multiple-choice-option {
            display: block;
            margin-bottom: 1rem;
            padding: 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .multiple-choice-option:hover,
        .multiple-choice-option.selected {
            background-color: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 255, 255, 0.4);
        }
        /* New navigation styles */
        .nav-button {
            background: none;
            border: none;
            color: #00FFFF;
            cursor: pointer;
            padding: 1rem;
            transition: all 0.3s ease;
            opacity: 0.7;
        }
        .nav-button:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .qotd-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4rem;
        }
        /* New styles for the navigation arrows */
        .nav-arrows button {
            background-color: #00FFFF;
            border-radius: 50%;  /* Circular shape */
            padding: 1rem;
            font-size: 2rem;  /* Bigger size */
            color: #FFFFFF;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;  /* Width of the circular button */
            height: 60px;  /* Height of the circular button */
        }

        /* Increase size on hover instead of going down */
        .nav-arrows button:hover {
            transform: scale(1.2);  /* Increase in size */
            opacity: 1;
            box-shadow: 0 2px 10px rgba(0, 255, 255, 0.4);
        }

        /* Style for when the arrows are disabled (first and last) */
        .nav-arrows button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Additional styles to gray out the arrows when disabled */
        .nav-arrows.left:disabled, .nav-arrows.right:disabled {
            background-color: #888;  /* Gray out the arrow buttons when disabled */
            color: #333;  /* Change the text color for disabled buttons */
        }

        .nav-arrows.left,
        .nav-arrows.right {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }

        .nav-arrows.left {
            left: 10px;  /* Position the left arrow */
        }

        .nav-arrows.right {
            right: 10px;  /* Position the right arrow */
        }
    </style>
</head>
<body>
    <div id="banner-container"></div>
    <header class="glass-header">
        <div class="logo-container">
            <h1 class="glow-text">Question of the Day</h1>
        </div>
        <div id="nav-container"></div>
    </header>
    <main class="fade-in">
        <div class="games-container">
            <h2 class="section-title glow-text">Today's Question</h2>
            <h4></h4>
            <center><h4><i>Sometimes, the QOTD takes a while to load because of its integrations. Give it a few seconds :)</i></h4></center>
            <div id="root"></div>
        </div>
    </main>

    <script type="module">
        // Load navigation from nav.html
        async function loadNav() {
            try {
                const response = await fetch('navnav.html');
                const nav = await response.text();
                document.getElementById('nav-container').innerHTML = nav;
            } catch (error) {
                console.error('Error loading navigation:', error);
                document.getElementById('nav-container').innerHTML = '<p>Error loading navigation. Please try again later.</p>';
            }
        }

        // Function to load the banner
        async function loadBanner() {
            try {
                const response = await fetch('banner.html');
                const bannerContent = await response.text();
                document.getElementById('banner-container').innerHTML = bannerContent;
            } catch (error) {
                console.error('Error loading banner:', error);
                document.getElementById('banner-container').innerHTML = '<p>Error loading banner. Please try again later.</p>';
            }
        }

        // Create and mount the React component
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        function QOTDNavigator() {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchQuestions();
            }, []);

            async function fetchQuestions() {
                try {
                    const response = await fetch('https://sheets.livepolls.app/api/spreadsheets/bc82dea8-d6f7-43dd-ac21-8d7de68f0d98/Sheet1');
                    const data = await response.json();
                    if (data.success) {
                        const sortedQuestions = data.data.sort((a, b) => new Date(a.Date) - new Date(b.Date));
                        setQuestions(sortedQuestions);
                        // Find today's question
                        const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
                        const todayIndex = sortedQuestions.findIndex(q => q.Date === today);
                        setCurrentIndex(todayIndex !== -1 ? todayIndex : sortedQuestions.length - 1);
                    }
                    setLoading(false);
                } catch (error) {
                    console.error('Error fetching questions:', error);
                    setLoading(false);
                }
            }

            const goToPrevious = () => {
                if (currentIndex > 0) {
                    setCurrentIndex(currentIndex - 1);
                }
            };

            const goToNext = () => {
                if (currentIndex < questions.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                }
            };

            // Handle answer submission
            const handleSubmit = (qotd) => {
                const feedbackElement = document.getElementById('feedback');
                const attemptsElement = document.getElementById('attempts');
                let attempts = parseInt(attemptsElement?.getAttribute('data-attempts') || '0');
                const maxAttempts = 3;

                attempts++;
                
                let userAnswer;
                const selectedOption = document.querySelector('.multiple-choice-option.selected');
                if (selectedOption) {
                    userAnswer = selectedOption.getAttribute('data-option');
                } else {
                    const textAnswer = document.getElementById('freeResponseAnswer');
                    userAnswer = textAnswer ? textAnswer.value.trim() : '';
                }

                const correctAnswer = qotd.Correct1.trim();

                if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    feedbackElement.textContent = 'Correct! Great job!';
                    feedbackElement.className = 'feedback correct';
                    document.getElementById('qotdSubmit').disabled = true;
                } else {
                    feedbackElement.textContent = attempts >= maxAttempts ? 
                        `Incorrect. The correct answer was: ${correctAnswer}` : 
                        'Incorrect. Try again!';
                    feedbackElement.className = 'feedback incorrect';
                    if (attempts >= maxAttempts) {
                        document.getElementById('qotdSubmit').disabled = true;
                    }
                }

                if (attemptsElement) {
                    attemptsElement.textContent = `Attempts: ${attempts}/${maxAttempts}`;
                    attemptsElement.setAttribute('data-attempts', attempts.toString());
                }
            };

            const displayQOTD = (qotd) => {
                const hasOptions = qotd.Options && qotd.Options.trim() !== "";
                const options = hasOptions ? qotd.Options.split('\n') : [];

                return React.createElement('div', { className: 'qotd-container' },
                    React.createElement('button', {
                        className: 'nav-button nav-arrows left',
                        onClick: goToPrevious,
                        disabled: currentIndex === 0
                    }, '←'),
                    React.createElement('div', { className: 'qotd-frame' },
                        React.createElement('div', { className: 'qotd-header' },
                            React.createElement('span', {
                                className: 'qotd-subject',
                                dangerouslySetInnerHTML: { __html: qotd.Subject }
                            }),
                            React.createElement('span', {
                                className: 'qotd-date'
                            }, qotd.Date)
                        ),
                        React.createElement('div', {
                            className: 'qotd-specifics'
                        }, qotd.Specifics),
                        React.createElement('div', {
                            className: 'qotd-question glow-text',
                            dangerouslySetInnerHTML: { __html: qotd.Question }
                        }),
                        React.createElement('div', { className: 'qotd-options' },
                            hasOptions ? 
                                options.map((option, index) =>
                                    React.createElement('div', {
                                        key: index,
                                        className: 'multiple-choice-option',
                                        'data-option': option,
                                        onClick: (e) => {
                                            document.querySelectorAll('.multiple-choice-option').forEach(opt => 
                                                opt.classList.remove('selected'));
                                            e.target.classList.add('selected');
                                        }
                                    }, option)
                                ) :
                                React.createElement('textarea', {
                                    id: 'freeResponseAnswer',
                                    placeholder: 'Type your answer here...'
                                })
                        ),
                        React.createElement('div', { className: 'qotd-submit' },
                            React.createElement('button', {
                                id: 'qotdSubmit',
                                onClick: () => handleSubmit(qotd)
                            }, 'Submit')
                        ),
                        React.createElement('div', { id: 'feedback', className: 'feedback' }),
                        React.createElement('div', { id: 'attempts', className: 'attempts', 'data-attempts': '0' })
                    ),
                    React.createElement('button', {
                        className: 'nav-button nav-arrows right',
                        onClick: goToNext,
                        disabled: currentIndex === questions.length - 1
                    }, '→')
                );
            };

            if (loading) {
                return React.createElement('div', { className: 'text-center p-8' }, 'Loading questions...');
            }

            return questions.length > 0 ? displayQOTD(questions[currentIndex]) : null;
        }

        // Mount the React component
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(QOTDNavigator));

        // Load navigation and banner
        document.addEventListener('DOMContentLoaded', () => {
            loadNav();
            loadBanner();
        });
    </script>
</body>
</html>
