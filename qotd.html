<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interlink QOTD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <style>
        .qotd-frame {
            background: var(--glass-background);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 2rem;
            margin: 0 auto;
            max-width: 800px;
        }
        .qotd-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .qotd-subject {
            color: #00FFFF;
            font-size: 1.2rem;
        }
        .qotd-date {
            color: #888;
            font-style: italic;
        }
        .qotd-specifics {
            color: #FFFFFF;
            margin-bottom: 1rem;
        }
        .qotd-question {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: #FFFFFF;
        }
        .qotd-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .qotd-options textarea {
            width: 100%;
            height: 150px;
            padding: 0.5rem;
            font-size: 1.5rem;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            resize: none;
            color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .qotd-submit {
            margin-top: 2rem;
            text-align: center;
        }
        #qotdSubmit {
            background: linear-gradient(45deg, #00FFFF, #0099FF);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        #qotdSubmit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }
        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        .feedback.correct {
            background-color: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        .feedback.incorrect {
            background-color: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }
        .feedback.hidden {
            opacity: 0;
        }
        .attempts {
            margin-top: 1rem;
            text-align: center;
            color: #888;
        }
        body {
            background-color: #1a1a1a;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #00FFFF;
        }
        .glow-text {
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        function QOTDNavigator() {
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [loading, setLoading] = useState(true);
            const [answered, setAnswered] = useState(false);

            useEffect(() => {
                fetchQuestion();
                // Check for midnight update every minute
                const interval = setInterval(() => {
                    const now = new Date();
                    const cstTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Chicago' }));
                    if (cstTime.getHours() === 0 && cstTime.getMinutes() === 0) {
                        fetchQuestion();
                    }
                }, 60000); // Check every minute

                return () => clearInterval(interval);
            }, []);

            async function fetchQuestion() {
                try {
                    const response = await fetch('https://sheets.livepolls.app/api/spreadsheets/0576df12-21e9-4d9f-8528-286ad2cd4cf5/Sheet1');
                    const data = await response.json();
                    if (data && data.length > 0) {
                        // Get random question
                        const randomIndex = Math.floor(Math.random() * data.length);
                        setCurrentQuestion(data[randomIndex]);
                    }
                    setLoading(false);
                } catch (error) {
                    console.error('Error fetching question:', error);
                    setLoading(false);
                }
            }

            const handleSubmit = () => {
                const feedbackElement = document.getElementById('feedback');
                const attemptsElement = document.getElementById('attempts');
                let attempts = parseInt(attemptsElement?.getAttribute('data-attempts') || '0');
                const maxAttempts = 3;

                attempts++;
                
                const textAnswer = document.getElementById('freeResponseAnswer');
                const userAnswer = textAnswer ? textAnswer.value.trim() : '';
                const correctAnswer = currentQuestion.Correct1.trim();

                if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    feedbackElement.textContent = 'Correct! Great job!';
                    feedbackElement.className = 'feedback correct';
                    document.getElementById('qotdSubmit').disabled = true;
                    setAnswered(true);
                } else {
                    feedbackElement.textContent = attempts >= maxAttempts ? 
                        `Incorrect. The correct answer was: ${correctAnswer}` : 
                        'Incorrect. Try again!';
                    feedbackElement.className = 'feedback incorrect';
                    if (attempts >= maxAttempts) {
                        document.getElementById('qotdSubmit').disabled = true;
                        setAnswered(true);
                    }
                }

                if (attemptsElement) {
                    attemptsElement.textContent = `Attempts: ${attempts}/${maxAttempts}`;
                    attemptsElement.setAttribute('data-attempts', attempts.toString());
                }
            };

            if (loading) {
                return React.createElement('div', { className: 'loading' },
                    React.createElement('p', null, 'Loading question of the day...')
                );
            }

            if (!currentQuestion) {
                return React.createElement('div', { className: 'loading' },
                    React.createElement('p', null, 'No question available.')
                );
            }

            return React.createElement('div', { className: 'qotd-frame' },
                React.createElement('div', { className: 'qotd-header' },
                    React.createElement('span', {
                        className: 'qotd-subject'
                    }, currentQuestion.Subject),
                    React.createElement('span', {
                        className: 'qotd-date'
                    }, new Date().toLocaleDateString())
                ),
                React.createElement('div', {
                    className: 'qotd-specifics'
                }, currentQuestion.Specifics),
                React.createElement('div', {
                    className: 'qotd-question glow-text'
                }, currentQuestion.Question),
                React.createElement('div', { className: 'qotd-options' },
                    React.createElement('textarea', {
                        id: 'freeResponseAnswer',
                        placeholder: 'Type your answer here...',
                        disabled: answered
                    })
                ),
                React.createElement('div', { className: 'qotd-submit' },
                    React.createElement('button', {
                        id: 'qotdSubmit',
                        onClick: handleSubmit,
                        disabled: answered
                    }, 'Submit')
                ),
                React.createElement('div', { id: 'feedback', className: 'feedback hidden' }),
                React.createElement('div', { id: 'attempts', className: 'attempts', 'data-attempts': '0' }, 'Attempts: 0/3')
            );
        }

        // Create root and render app
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(QOTDNavigator));
    </script>
</body>
</html>
